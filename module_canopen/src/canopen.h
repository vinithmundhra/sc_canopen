
#ifndef __can_open_h__
#define __can_open_h__

#include "common.h"
#include "can.h"
#include <xccompat.h>

#define MAX_NO_OF_PDOS 512


/**
* \enum condition_values
* \brief CANOpen Condition values
*/
enum condition_values
{
  TRUE  = 1, /**<CANOpen condition is TRUE */
  FALSE = 0  /**<CANOpen condition is FALSE */
};

/**
* \enum message_length
* \brief Message length of different CANOpen message types
* application.
*/
enum message_length
{
  NMT_MESSAGE_LENGTH       = 2, /**<CANOpen NMT Message length */
  LSS_MESSAGE_LENGTH       = 8, /**<CANOpen LSS Message length */
  SYNC_MESSAGE_LENGTH      = 0, /**<CANOpen SYNC Message length */
  HEARTBEAT_MESSAGE_LENGTH = 0, /**<CANOpen Heartbeat Message length */
  SDO_MESSAGE_LENGTH       = 8  /**<CANOpen SDO Message length */
};

/**
* \enum states_canopen
* \brief Different CANOpen states supported by this module according to DS 301
* application.
*/
enum states_canopen
{
  INITIALIZATION      = 0x00, /**<CANOpen NMT Intitialization state */
  PRE_OPERATIONAL     = 0x80, /**<CANOpen NMT pre-operational state */
  OPERATIONAL         = 0x01, /**<CANOpen NMT operational satate */
  STOPPED             = 0x02, /**<CANOpen NMT stopped satate */
  RESET_NODE          = 0x81, /**<CANOpen NMT reset-node satate */
  RESET_COMMUNICATION = 0x82  /**<CANOpen NMT reset communication satate */
};


/**
* \enum node_guard_states
* \brief CANOpen Noduguard / Heartbeat respsonses sent to the Master
* application.
*/
enum node_guard_states
{
  NG_BOOT_UP         = 0x00, /**<CANOpen NMT Nodeguard response bootup state */
  NG_STOPPED         = 0x04, /**<CANOpen NMT Nodeguard response stopped state */
  NG_OPERATIONAL     = 0x05, /**<CANOpen NMT Nodeguard response operational state */
  NG_PRE_OPERATIONAL = 0x7F  /**<CANOpen NMT Nodeguard response pre operational state */
};


/**
* \enum cob_id
* \brief COB-ID supported by CANOpen module according to DS 301
* application.
*/
enum cob_id
{
  NMT_MESSAGE           = 0     + CANOPEN_NODE_ID, /**<CANOpen COB-ID nmt state Message*/
  NMT_MESSAGE_BROADCAST = 0,                       /**<CANOpen COB-ID nmt Broadcast Message*/
  SYNC                  = 0x80,                    /**<CANOpen COB-ID sync Message */
  TIME_STAMP            = 0x100 + CANOPEN_NODE_ID, /**<CANOpen COB-ID timestamp Message */
  NG_HEARTBEAT          = 0x700 + CANOPEN_NODE_ID, /**<CANOpen COB-ID heartbeat / nodeguard Message */
  EMERGENCY_MESSAGE     = 0x80,                    /**<CANOpen COB-ID emergency Message */
  TPDO_0_MESSAGE        = 0x180 + CANOPEN_NODE_ID, /**<CANOpen COB-ID transmit pdo 0 Message */
  RPDO_0_MESSAGE        = 0x200 + CANOPEN_NODE_ID, /**<CANOpen COB-ID receive pdo 0 Message */
  TPDO_1_MESSAGE        = 0x280 + CANOPEN_NODE_ID, /**<CANOpen COB-ID transmit pdo 1 Message */
  RPDO_1_MESSAGE        = 0x300 + CANOPEN_NODE_ID, /**<CANOpen COB-ID receive pdo 1 Message */
  TPDO_2_MESSAGE        = 0x380 + CANOPEN_NODE_ID, /**<CANOpen COB-ID transmit pdo 2 Message */
  RPDO_2_MESSAGE        = 0x400 + CANOPEN_NODE_ID, /**<CANOpen COB-ID receive pdo 2 Message */
  TPDO_3_MESSAGE        = 0x480 + CANOPEN_NODE_ID, /**<CANOpen COB-ID transmit pdo 3 Message */
  RPDO_3_MESSAGE        = 0x500 + CANOPEN_NODE_ID, /**<CANOpen COB-ID receive pdo 3 Message */
  TSDO_MESSAGE          = 0x580 + CANOPEN_NODE_ID, /**<CANOpen COB-ID transmit sdo Message */
  RSDO_MESSAGE          = 0x600 + CANOPEN_NODE_ID, /**<CANOpen COB-ID receive sdo Message */
  RLSS_MESSAGE          = 0x7E5 + CANOPEN_NODE_ID, /**<CANOpen COB-ID receive LSS Message */
  TLSS_MESSAGE          = 0x7E4                    /**<CANOpen COB-ID transmit LSS Message */
};


void canopen_server(streaming chanend c_rx_tx, streaming chanend c_application);

#endif
